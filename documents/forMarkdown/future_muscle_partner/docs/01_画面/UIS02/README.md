# [UIS02] マイページ

## 概要

機能目的:

- トレーニーのマイページを表示し、受講予定・受講済みのトレーニング一覧を表示する

機能概要:

- 受講状況の表示
- パーソナルトレーナーの検索への導線

## イベント概要

| No | イベント名    | イベント分類 | 処理説明                           |
|----|----------|--------|--------------------------------|
| 1  | 初期表示     | 初期表示   | 初期検索条件に従いAPIを実行し、履歴表示する        |
| 2  | トレーナーを探す | ボタン押下  | パーソナルトレーナー検索モーダル起動             |
| 3  | トレーナー検索  | ボタン押下  | 入力された条件で検索                     |
| 4  | 受講完了確認   | ボタン押下  | 予約済みトレーニングを受講完了に切り替えるためのモーダル起動 |
| 5  | 受講完了     | ボタン押下  | 予約済みトレーニングを完了済みのトレーニングに更新      |

## イベント詳細

### 1. 初期表示

起動パラメータ:

| Name | Value | Memo |
| --- | --- | --- |
| userState | {"user_id":"<user_id>"} | ログイン状態 |

初期表示イベント:

- マイページ表示

利用API:

| ID  |  URL | Parameter |
| --- | --- | -- |
| API-005 | GET /profile/{trainee_id} | trainee_id=userState.user_id |

画面表示制御:

- HTTPステータスが500系
  - メッセージID（MSG_BIZ_111）表示
- HTTPステータスが400系
  - トップページにリダイレクト

利用API:

| ID  |  URL | Parameter |
| --- | --- | -- |
| API-013 | GET /bookings/{trainee_id} | trainee_id=userState.user_id |

画面表示制御:

- 起動条件
  - API-016が有効な場合
- HTTPステータスが200以外
  - メッセージID（MSG_BIZ_111）表示

### 2. トレーナーを探す

「パーソナルトレーナー検索モーダル」を起動する。

### 3. トレーナー検索

利用API:

| ID  |  URL | Parameter |
| --- | --- | -- |
| API-007 | GET /trainers | モーダルに指定された値をクエリパラメータに設定する |

画面表示制御:

- 入力チェック
  - favorite_gym_name, store_nameが未設定の場合は、フロントエンド側でチェックし「行きつけのジム名・店舗名は必須項目です」と表示する
- 応答が0件の場合
  - 「条件に一致するコーチは存在しませんでした」と表示する
- HTTPステータスが200以外
  - メッセージID（MSG_BIZ_111）表示

### 3. 受講完了確認

「`${トレーニングメニュー}` は完了しましたか？」ダイアログを表示する。

キャンセルの場合は閉じる。

### 3. 受講完了

「`${トレーニングメニュー}` は完了しましたか？」ダイアログがOKの場合。

利用API:

| ID  |  URL | Parameter |
| --- | --- | -- |
| API-016 | PUT /booking/{booking_id}/status | 選択されたトレーニング予約ID |

画面表示制御:

- クリック可否判定
  - 予約済み＋現在時間<=受講時間になっている場合に、クリック可能とする
- HTTPステータスが200以外
  - メッセージID（MSG_BIZ_111）表示
- HTTPステータスが200
  - 次のAPIを呼び出し

利用API:

| ID  |  URL | Parameter |
| --- | --- | -- |
| API-012 | GET /bookings/{trainee_id} | trainee_id=userState.user_id |

画面表示制御:

- 起動条件
  - API-016が有効な場合
- HTTPステータスが200以外
  - メッセージID（MSG_BIZ_111）表示
