# ブランチの整理

本ドキュメントで想定する、各ブランチの特徴を説明する。

| ブランチ名称           | 役割                                                  | ライフサイクル | 利用シーン                                                                                                                                                                                       | 命名規則                                                                                                                               | 直push可否 | 
| -------------- | ----------------------------------------------------- | ----- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------- | ---------- | 
| `main` | production環境と一致させるブランチ                    | 永続的 | すべてのケースで使用                                                                                                                                                                             | `main`: 原則変更しない                                                                                                             | ✕         |
| `feature`      | 特定機能の追加/変更                                   | 短命 | ほぼすべてのケースで使用<br>個人開発ではmainブランチのみの使用もあり得る。                                                                                                                       | `feature/${任意名称}`: 詳細はfeatureブランチの章に記載する                                                                        | △         |
| `develop`      | 開発の大元となるブランチ                              | 永続的 | リリース断面と開発断面を分けたい場合にmainブランチから作成する。<br>マージの都度リリースする前提であればmainブランチとfeatureブランチのみでも運用可能。                                          | `develop`: 原則変更しない。複数のdevelopブランチが発生した場合は `develop2` と連番で区別する | ✕         |
| `release`      | リリース準備作業の実施                                | 短命 | developブランチの利用が前提となる。<br>開発作業とリリース作業が並行する場合にdevelopブランチから作成する。                                                                                       | `release/${yyyymmdd}` や `release/${リリースバージョン}` など                                                                       | ✕         |
| `hotfix`       | mainブランチに対する即時修正                          | 短命 | developブランチの利用が前提となる。<br>本番リリースに対して迅速にパッチを当てたい場合にmainブランチから作成する。<br>mainブランチとfeatureブランチのみの運用の場合は必ずしも利用する必要はない。 | `hotfix/${任意名称}`: 可能な限りわかりやすい命名とする                                                                         | ◯         |
| `topic`        | featureブランチにて複数人開発をする場合の開発ブランチ | 短命 | featureブランチで実現する機能を複数人で開発する場合にfeatureブランチから作成する。                                                                                                               | `topic/${任意名称}`: 可能な限りわかりやすい命名とする                                                                          | ◯         |

## mainブランチ

Gitリポジトリを新規作成するとデフォルトで作成されるブランチで、主な特徴は以下である。

- 過去はmasterだったが最近はmainという名称に改名された
- 個人開発であればmainブランチに直接pushして開発することもできるが、チーム開発では直接push禁止でマージを行うだけのブランチとして扱う
- production環境と対応するブランチとなる場合が多い

## featureブランチ

機能追加や変更を行うブランチで、主な特徴は以下である。

- ひとつの変更に対してひとつのfeatureブランチを作成することになるため、開発中で最も使われる短命なブランチとなる
- mainブランチあるいはdevelopブランチから派生させ、作業完了後に作成元ブランチにマージし、その後削除する
- 後述するtopicブランチを利用しない場合は、基本的に1人の開発者のみが利用する

![feature branch](image/branch_strategy_feature.drawio.png)

以下の命名に従う。

- `feature/` のプレフィックスを付ける
- 課題管理システムと紐付けられるようなブランチ名にする

```sh
# OK（課題管理システムの課題番号をブランチ名に利用）
feature/#12345

# OK（GitHub Issue や JIRA や Backlog のプロジェクトIDをブランチ名に利用）
feature/<PROJECTID>-9403
feature/gh-issue-12345

# NG（プレフィックスが無い）
fixtypo
```

## developブランチ

開発の中心となるブランチで、主な特徴は以下である。

- リポジトリを新規作成した際にmainブランチからdevelopブランチを作成する
- 各開発者はdevelopブランチからfeatureブランチを作成し、機能追加/変更を行う
- 都度リリースをするのであればmainブランチとfeatureブランチのみの運用でも問題ないが、リリース断面と開発断面を分けたい場合にdevelopブランチを利用する
- 体制・開発スケジュールによっては複数のdevelopブランチが発生することもある

![develop branch](image/branch_strategy_develop.drawio.png)

## releaseブランチ

リリースするために使用するブランチで、主な特徴は以下である。

- リリース前の検証を開発と並行して実施する場合に発生する
- 開発とリリース作業が並行しないのであればdevelopブランチでそのまま検証を実施すれば良いので、場合によっては不要となる
- releaseブランチではバグ修正、ドキュメント生成、その他のリリースに伴うタスクのみを実施する
- developブランチからreleaseブランチを作成、リリース準備作業を実施し、mainブランチへマージ後、mainブランチからリリースを行う
- masterブランチのマージコミットにリリースタグ（バージョンなど）を打ち、mainブランチをdevelopブランチへマージ後、releaseブランチを削除する

![release branch](image/branch_strategy_release.drawio.png)

## hotfixブランチ

本番リリースに対して迅速にパッチを当てて修正する場合に使用するブランチで、主な特徴は以下である。

- developブランチではなく、mainブランチをベースとする
- 修正が完了するとmainとdevelopの両方(あるいは進行中のreleaseブランチ)に直ちにマージされ、mainは更新されたバージョン番号でタグ付けされる
- mainブランチとdevelopブランチが分かれている場合はほぼ必須で発生すると考えて良いが、mainブランチ+featureブランチのみの運用では必ずしも必要ではない。（管理上の目的でfeatureとhotfixを分けることはあり得る。）  

![hotfix branch](image/branch_strategy_hotfix.drawio.png)

命名はfeatureブランチと同じく、課題管理システムと紐づけるようなブランチ名とする。

## topicブランチ  

featureブランチで実現する機能を複数人で開発する場合に使用するブランチで、主な特徴は以下である。

- featureブランチからtopicブランチを作成し、topicブランチ上で個人の開発を行った後、featureブランチへマージする。（masterブランチ/developブランチとfeatureブランチの関係と同等。）
- topicブランチが必要なケースでは、featureブランチへの直接pushは原則行わない
- GitHub Flowではfeatureブランチのことをtopicブランチと呼称する場合があるが、本規約ではfeatureブランチから派生するブランチをtopicブランチと定義する

![topic branch](image/branch_strategy_topic.drawio.png)

命名はfeatureブランチと同じく、課題管理システムと紐づけるようなブランチ名とする。
