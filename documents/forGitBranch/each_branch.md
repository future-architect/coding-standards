# ブランチの整理

本ドキュメントで想定する、各ブランチの特徴を説明する。

| ブランチ名称           | 役割                                                  | 利用シーン                                                                                                                                                                                       | 命名規則                                                                                                                               | 直push可否 | 
| -------------- | ----------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------- | ---------- | 
| `main(master)` | production環境と一致させるブランチ                    | すべてのケースで使用                                                                                                                                                                             | `main`<br>原則変更しない。                                                                                                             | ✕         | 
| `feature`      | 特定機能の追加/変更                                   | ほぼすべてのケースで使用<br>個人開発ではmainブランチのみの使用もあり得る。                                                                                                                       | `feature/${任意名称}`<br>可能な限りわかりやすい命名とすること。                                                                        | △         | 
| `develop`      | 開発の大元となるブランチ                              | リリース断面と開発断面を分けたい場合にmainブランチから作成する。<br>マージの都度リリースする前提であればmainブランチとfeatureブランチのみでも運用可能。                                          | `develop/develop`<br>※developにするとdevelopブランチが複数発生するケースに耐えられないので、develop/developとしておくことを推奨する。 | ✕         | 
| `release`      | リリース準備作業の実施                                | developブランチの利用が前提となる。<br>開発作業とリリース作業が並行する場合にdevelopブランチから作成する。                                                                                       | `release/${yyyymmdd}`<br>`release/${リリースバージョン}`<br>など                                                                       | ✕         | 
| `hotfix`       | mainブランチに対する即時修正                          | developブランチの利用が前提となる。<br>本番リリースに対して迅速にパッチを当てたい場合にmainブランチから作成する。<br>mainブランチとfeatureブランチのみの運用の場合は必ずしも利用する必要はない。 | `hotfix/${任意名称}`<br>可能な限りわかりやすい命名とすること。                                                                         | ◯         | 
| `topic`        | featureブランチにて複数人開発をする場合の開発ブランチ | featureブランチで実現する機能を複数人で開発する場合にfeatureブランチから作成する。                                                                                                               | `topic/${任意名称}`<br>可能な限りわかりやすい命名とすること。                                                                          | ◯         | 

## main(master)ブランチ

Gitリポジトリを新規作成するとデフォルトで作成されるブランチ。  
過去はmasterだったが最近はmainという名称に改名されている。  
個人開発であればmainブランチに直接pushして開発することもできるが、チーム開発では直接push禁止でマージを行うだけのブランチとなる。  
production環境と対応するブランチとなる場合が多い。

## featureブランチ

機能追加や変更を行うブランチ。  
ひとつの変更に対してひとつのfeatureブランチを作成することになるため、開発中で最も使われるブランチとなる。  
mainブランチあるいはdevelopブランチから派生させ、作業完了後に作成元ブランチにマージする。  

![feature branch](image/branch_strategy_feature.drawio.png)

## developブランチ

開発の中心となるブランチ。  
リポジトリを新規作成した際にmainブランチからdevelopブランチを作成する。  
各開発者はdevelopブランチからfeatureブランチを作成し、機能追加/変更を行う。  
都度リリースをするのであればmainブランチとfeatureブランチのみの運用でも問題ないが、リリース断面と開発断面を分けたい場合にdevelopブランチを利用する。  
開発スケジュールによっては複数のdevelopブランチが発生することもある。  

![develop branch](image/branch_strategy_develop.drawio.png)

## releaseブランチ

リリースするために使用するブランチ。  
リリース前の検証を開発と並行して実施する場合に発生する。  
開発とリリース作業が並行しないのであればdevelopブランチでそのまま検証を実施すれば良いので、場合によっては不要となる。  
releaseブランチではバグ修正、ドキュメント生成、その他のリリースに伴うタスクのみを実施する。  
developブランチからreleaseブランチを作成、リリース準備作業を実施し、mainブランチへマージ後、mainブランチからリリースを行う。  
masterブランチのマージコミットにリリースタグ（バージョンなど）を打ち、mainブランチをdevelopブランチへマージ後、releaseブランチを削除する。  

![release branch](image/branch_strategy_release.drawio.png)

## hotfixブランチ

本番リリースに対して迅速にパッチを当てて修正する場合に使用する。  
developブランチではなく、mainブランチをベースとする。  
修正が完了するとmainとdevelopの両方(あるいは進行中のreleaseブランチ)に直ちにマージされ、mainは更新されたバージョン番号でタグ付けされる。  
mainブランチとdevelopブランチが分かれている場合はほぼ必須で発生すると考えて良いが、mainブランチ+featureブランチのみの運用では必ずしも必要ではない。（管理上の目的でfeatureとhotfixを分けることはあり得る。）  

![hotfix branch](image/branch_strategy_hotfix.drawio.png)

## topicブランチ  

featureブランチで実現する機能を複数人で開発する場合に使用する。  
featureブランチからtopicブランチを作成し、topicブランチ上で個人の開発を行った後、featureブランチへマージする。（masterブランチ/developブランチとfeatureブランチの関係と同等。）  
topicブランチが必要なケースでは、featureブランチへの直接pushは原則行わない。  
GitHub Flowではfeatureブランチのことをtopicブランチと呼称する場合があるが、本規約ではfeatureブランチから派生するブランチをtopicブランチと定義する。  

![topic branch](image/branch_strategy_topic.drawio.png)
